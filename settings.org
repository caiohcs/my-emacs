#+TITLE: My Emacs configuration
#+AUTHOR: Caio Henrique
#+OPTIONS: toc:nil

* My Emacs configuration
[[./imgs/my-emacs.png]] 

My configuration has 59 packages installed. It loads fast, in my machine Doom Emacs takes around 0.7s to start, my configuration takes around 0.9s. I don't care much about startup time since I never close my Emacs, so I haven't tried using advanced optimizations like Byte compilation.

I like Hydra-mode since it's easy to customize, so for fast navigation and quick insertions I use one Hydra. I tap F1 to call the Hydra body, then I can do stuff like:

| Key | Action                 |
|-----+------------------------|
| f   | forward word           |
| b   | backward word          |
| v   | page down              |
| V   | page up                |
| i   | quick insertion        |
| s   | save position          |
| j   | jump to saved position |
| g   | jump to a line number  |
| G   | avy jump to word       |
| SPC | set mark command       |
| m   | mark all like region   |
| M   | mark lines             |
| w   | kill region            |
| W   | kill region and save   |
| y   | popup kill ring        |
| ... | ...                    |

There are also other Hydras for window management (using eyebrowse), buffer/window movement and avy.

* Installation
- Copy init.el and settings.org to ~/.emacs.d/
- Install all package requirements. For instance, C/C++ utilities requires clang.

* Programming
** Company
#+BEGIN_SRC emacs-lisp
(use-package company
  :ensure t
  :defer 2.3
  :init
  (use-package company-quickhelp
    :ensure t)
  :config
  (company-quickhelp-mode))
#+END_SRC

** Language Server Protocol
I use LSP for C and C++.
#+BEGIN_SRC emacs-lisp
(use-package lsp-mode
  :ensure t
  :hook
  ((c++-mode . lsp)
  (c-mode . lsp))
  :commands lsp)
#+END_SRC

** Projectile
I think that LSP requires projectile, so it's going to be installed as a dependency anyway.
#+BEGIN_SRC emacs-lisp
(use-package projectile
  :ensure t
  :commands projectile-command-map) 
#+END_SRC

** Syntax checking
#+BEGIN_SRC emacs-lisp
;; Provides some syntax checking
(use-package flycheck
  :ensure t
  :defer 4.3)
#+END_SRC

** C and C++
*** Requirements
- Requires clang installed on the system.
- Requires ccls installed on the system. https://github.com/MaskRay/ccls 
I'm assuming that the ccls binary is at /usr/bin/ccls.

*** Config
#+BEGIN_SRC emacs-lisp
;;; C/C++
(use-package cmake-ide
  :ensure t
  :defer 7.4
  :config (cmake-ide-setup))

(use-package ccls
  :requires lsp-mode
  :ensure t
  :config
  (setq ccls-executable "/usr/bin/ccls"))

(defun my-c-mode-common-hook ()
  (c-set-offset 'substatement-open 0)
  (setq  c-default-style "bsd"
	 c-basic-offset 4
	 c-indent-level 4
	 c-indent-tabs-mode t
	 c-tab-always-indent t
	 c++-tab-always-indent t
	 tab-width 4
	 backward-delete-function nil)
  (company-mode))

(add-hook 'c++-mode-common-hook 'my-c-mode-common-hook)
(add-hook 'c-mode-common-hook 'my-c-mode-common-hook)
#+END_SRC

** Golang
*** Requirements
Autocompletion requires gocode, available at https://github.com/nsf/gocode.
We can install gocode with go get, then we need to create a symbolic link at /usr/bin.

*** Config
#+BEGIN_SRC emacs-lisp
;; Requires gocode https://github.com/nsf/gocode
;; After installing gocode, we also have to create a symbolic link
(use-package go-mode
  :ensure t
  :mode ("\\.go\\'" . go-mode)
  :config
  (use-package company-go
    :requires company
    :ensure t)
  (use-package go-errcheck
    :ensure t)
  (defun my-go-mode-hook ()
    (setq tab-width 4)
    (setq gofmt-command "goimports")
    (set (make-local-variable 'company-backends) '(company-go))
    (company-mode))
  (add-hook 'go-mode-hook 'my-go-mode-hook))
#+END_SRC

** Color identifiers
#+BEGIN_SRC emacs-lisp
(use-package color-identifiers-mode
  :disabled
  :ensure t
  :defer 9)
#+END_SRC

** Lisp
I use Steel Bank Common Lisp.
*** Config
#+BEGIN_SRC emacs-lisp
;;; Lisp
(use-package slime
  :ensure t
  :commands slime
  :config
  (setq inferior-lisp-program "sbcl")
  (setq slime-contribs '(slime-fancy)))

(use-package slime-company
  :after (slime company)
  :ensure t
  :init
  (slime-setup '(slime-fancy slime-company)))
#+END_SRC

** Yaml
I left the Yaml package disabled, so delete the :disabled line if you want this package.
#+BEGIN_SRC emacs-lisp
(use-package yaml-mode
  :disabled
  :ensure t
  :mode ("\\.yml\\'" . yaml-mode))
#+END_SRC

** Docker
I left the Docker packages disabled, so delete the :disabled line if you want these packages.
#+BEGIN_SRC emacs-lisp
(use-package docker
  :disabled
  :ensure t
  :commands docker)

(use-package dockerfile-mode
  :disabled
  :ensure t
  :defer 4)
(add-to-list 'auto-mode-alist '("Dockerfile\\'" . dockerfile-mode))
#+END_SRC

* Dashboard
#+BEGIN_SRC emacs-lisp
(use-package dashboard
  :ensure t
  :init
  (setq initial-buffer-choice (lambda () (get-buffer "*dashboard*")))
  :config
  ;; Dashboard requirements.
  (use-package page-break-lines
    :ensure t)
  (use-package all-the-icons
    :ensure t)
  ;; Dashboard configuration.
  (dashboard-setup-startup-hook)
  (setq dashboard-banner-logo-title "Welcome to Emacs")
  (setq dashboard-startup-banner 'logo)
  (setq dashboard-items '((recents   . 5)
                          (bookmarks . 5)
                          (agenda    . 5)
                          (registers . 5)))
  (setq dashboard-set-init-info t)
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t))
#+END_SRC

* Org
** Config
#+BEGIN_SRC emacs-lisp
;;; org
(use-package org
  :ensure t
  :mode ("\\.org\\'" . org-mode)
  :diminish org-indent-mode
  :config
  (setq org-startup-indented t)
  (org-babel-do-load-languages
   'org-babel-load-languages
   '( (python . t)
      (emacs-lisp . t)
      (lisp . t)
      (C . t))))

(use-package org-bullets
  :after org
  :ensure t
  :config (add-hook 'org-mode-hook (lambda () (org-bullets-mode))))
#+END_SRC

** Exporting
#+BEGIN_SRC emacs-lisp
;; Export to html with syntax highlighting
(use-package htmlize
  :after org
  :ensure t
  :commands org-export-dispatch)

;; Export to Markdown with syntax highlighting
(use-package ox-gfm
  :after org
  :ensure t
  :commands org-gfm-export-to-markdown)
#+END_SRC

*** Presentations
**** Requirements
Requires reveal.js to create html presentations.

**** Config
#+BEGIN_SRC emacs-lisp
;; Package used to create presentations using reveal.js.
;; Requires the installation of reveaj.js.
(use-package ox-reveal
  :after org
  :ensure t
  :commands org-reveal-export-to-html
  :config
  (setq org-reveal-root "file:///home/spvk/notes/presentations/reveal.js"))
#+END_SRC

* Magit
#+BEGIN_SRC emacs-lisp
(use-package magit
  :ensure t
  :defer 9.2)

(global-set-key (kbd "\C-x g") 'magit-status)
#+END_SRC

* Theme
My favorite themes packages are zerodark-theme, kaolin-themes, moe-theme and dracula-theme.
#+BEGIN_SRC emacs-lisp
;; zerodark-theme kaolin-themes moe-theme dracula-theme are nice themes
(use-package kaolin-themes
  :ensure t)
#+END_SRC

* Treemacs
#+BEGIN_SRC emacs-lisp
(use-package treemacs
  :ensure t
  :defer 12.4)
#+END_SRC

* Global
** Hydra
#+BEGIN_SRC emacs-lisp
(use-package hydra
  :ensure t
  :defer 2.5
  :config
  (defhydra hydra-buff-move ()
    "buff-move"
    ("q" nil "quit")
    ("<left>" buf-move-left)
    ("<right>" buf-move-right)
    ("<top>" buf-move-top)
    ("<bottom>" buf-move-bottom))
    (global-set-key (kbd "C-: b") 'hydra-buff-move/body)

  (defhydra hydra-wind-move ()
    "wind-move"
    ("q" nil "quit")
    ("<left>" windmove-left)
    ("<right>" windmove-right)
    ("<top>" windmove-top)
    ("<bottom>" windmove-bottom))
    (global-set-key (kbd "C-: w") 'hydra-wind-move/body)

  (defhydra hydra-eyebrowse ()
    "eyebrowse"
    ("q" nil "quit")
    ("p" eyebrowse-prev-window-config nil)
    ("n" eyebrowse-next-window-config nil)
    ("l" eyebrowse-last-window-config nil)
    ("r" eyebrowse-rename-window-config nil)
    ("c" eyebrowse-create-window-config nil)
    ("C" eyebrowse-close-window-config nil)
    ("0" eyebrowse-switch-to-window-config-0 nil)
    ("1" eyebrowse-switch-to-window-config-1 nil)
    ("2" eyebrowse-switch-to-window-config-2 nil)
    ("3" eyebrowse-switch-to-window-config-3 nil)
    ("4" eyebrowse-switch-to-window-config-4 nil)
    ("5" eyebrowse-switch-to-window-config-5 nil)
    ("6" eyebrowse-switch-to-window-config-6 nil)
    ("7" eyebrowse-switch-to-window-config-7 nil)
    ("8" eyebrowse-switch-to-window-config-8 nil)
    ("9" eyebrowse-switch-to-window-config-9 nil))
    (global-set-key (kbd "C-: e") 'hydra-eyebrowse/body)

  (defhydra hydra-avy (:color blue :hint nil)
    "
    _w_: word      _n_: word bellow   _p_: word above
    "
    ("q" nil "quit")
    ("w" avy-goto-word-1)
    ("p" avy-goto-word-1-above)
    ("n" avy-goto-word-1-below))
    (global-set-key (kbd "M-s") 'hydra-avy/body)

  (defhydra hydra-movement (:color amaranth :hint nil)
    "
    _f_: next word   _b_: prev word    _n_: next line     _p_: prev line
    _s_: save point  _j_: jump point   _w_: kill region   _W_: kill region save
    _<SPC>_: mark    _y_: yank         _v_: page down     _V_: page up
    _l_: recenter    _G_: goto line    _a_: beg line      _e_: end line
    _F_: next char   _B_: prev char    _g_: avy word      _i_: quick insertion
    _=_: exp region  _m_: mark all     _M_: edit lines    _u_: universal arg
    "
    ("<f1>" nil "quit")
    ("f" forward-word)
    ("b" backward-word)
    ("n" next-line)
    ("p" previous-line)
    ("s" (point-to-register 'g))
    ("j" (jump-to-register 'g))
    ("w" kill-region)
    ("W" kill-ring-save)
    ("<SPC>" set-mark-command)
    ("y" popup-kill-ring)
    ("v" scroll-up)
    ("V" scroll-down)
    ("l" recenter-top-bottom)
    ("G" goto-line)
    ("a" beginning-of-line)
    ("e" end-of-line)
    ("F" forward-char)
    ("B" backward-char)
    ("g" avy-goto-word-1)
    ("i" (lambda (txt)
           (interactive "sQuick insertion:")
           (insert txt)))
    ("=" er/expand-region)
    ("m" mc/mark-all-like-this)
    ("M" mc/edit-beginnings-of-lines)
    ("u" universal-argument))
    (global-set-key (kbd "<f1>") 'hydra-movement/body))
#+END_SRC

** Emacs completion
#+BEGIN_SRC emacs-lisp
;;; Global
;; Ivy is a generic completion tool
(use-package ivy
  :ensure t
  :diminish ivy-mode
  :defer 1.1
  :config
  (ivy-mode)
  (use-package swiper
    :ensure t
    :bind (("\C-s" . swiper)))
  :config
  (use-package counsel
    :ensure t))
#+END_SRC

** Kill ring
#+BEGIN_SRC emacs-lisp
(use-package popup-kill-ring
  :ensure t
  :bind (("M-y" . popup-kill-ring))) 
#+END_SRC

** Modeline
#+BEGIN_SRC emacs-lisp
(display-time-mode t)

(use-package spaceline
  :ensure t
  :defer 2.2
  :config
  (require 'spaceline-config)
  (setq powerline-default-separator (quote arrow))
  (setq spaceline-line-column-p nil)
  (setq spaceline-buffer-size nil)
  (setq spaceline-workspace-numbers-unicode t)
  (setq spaceline-buffer-encoding-abbrev-p nil)
  (spaceline-spacemacs-theme))
#+END_SRC

** Parentheses
#+BEGIN_SRC emacs-lisp
(use-package smartparens
  :ensure t
  :defer 5.1
  :diminish smartparens-mode
  :config 
  (smartparens-global-mode)
  (sp-local-pair 'org-mode "*" "*")
  (sp-local-pair 'org-mode "_" "_"))

(use-package highlight-parentheses
  :ensure t
  :defer 12.1
  :diminish highlight-parentheses-mode
  :config (global-highlight-parentheses-mode))

(defvar show-paren-delay 0)
(show-paren-mode t)
#+END_SRC

** Buffer moving
#+BEGIN_SRC emacs-lisp
(use-package buffer-move
  :ensure t
  :bind
  (("C-c <C-up>"   . buf-move-up)
   ("C-c <C-down>"  . buf-move-down)
   ("C-c <C-left>"  . buf-move-left)
   ("C-c <C-right>" . buf-move-right)))
#+END_SRC

** Windows moving
#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "C-c <M-up>") 'windmove-up) 
(global-set-key (kbd "C-c <M-down>") 'windmove-down) 
(global-set-key (kbd "C-c <M-right>") 'windmove-right) 
(global-set-key (kbd "C-c <M-left>") 'windmove-left) 
#+END_SRC

** Multiple cursors
#+BEGIN_SRC emacs-lisp
(use-package multiple-cursors
  :ensure t
  :bind (("C-: C-m b" . mc/edit-lines)
	 ("C-: C-m a" . mc/mark-all-like-this)
	 ("C-: C-m >" . mc/mark-next-like-this)
	 ("C-: C-m <" . mc/mark-previous-like-this)))
#+END_SRC

** Text navigation
#+BEGIN_SRC emacs-lisp
(use-package avy
  :ensure t
  :bind (("M-s" . avy-goto-word-1)))
#+END_SRC

** Windows management
#+BEGIN_SRC emacs-lisp
(use-package eyebrowse
  :ensure t
  :config (eyebrowse-mode t))
#+END_SRC

** Smart region expanding
#+BEGIN_SRC emacs-lisp
(use-package expand-region
  :ensure t
  :bind (("C-=" . er/expand-region)))
#+END_SRC

** Tool bar, menu bar, line numbering etc
#+BEGIN_SRC emacs-lisp
;;; Variables
(global-visual-line-mode)
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)
(global-linum-mode)
(global-set-key (kbd "TAB") 'self-insert-command)
(global-set-key (kbd "\C-c h") 'highlight-symbol-at-point)
#+END_SRC

** Change backup/autosave folder
#+BEGIN_SRC emacs-lisp
;;; Change the backup/autosave folder.
(defvar backup-dir (expand-file-name "~/.emacs.d/backup/"))
(defvar autosave-dir (expand-file-name "~/.emacs.d/autosave/"))
(setq backup-directory-alist (list (cons ".*" backup-dir)))
(setq auto-save-list-file-prefix autosave-dir)
(setq auto-save-file-name-transforms `((".*" ,autosave-dir t)))
#+END_SRC

** Read process output
Sets read-process-output-max to 1mb since the default is low. This should improve things that use servers like LSP.
#+BEGIN_SRC emacs-lisp
(setq read-process-output-max (* 1024 1024))
#+END_SRC

** Spell checking
I use aspell for spell checking.
*** Config
#+BEGIN_SRC emacs-lisp
(defvar ispell-program-name "aspell")
#+END_SRC

* Latin accents
I created this function to insert the latin accents that I use the most.
#+BEGIN_SRC emacs-lisp
;; latin accents
(defun my-latin-accents-function (start end)
  (interactive "r")
  (defun cmp-and-fixcase (reg cmp out)
    (let ((case-fold-search t))
      (if (string-match-p reg cmp)
       	  (let ((case-fold-search nil))
	    (if (string-match-p "\\`[a-z]*\\'" reg)
               	(progn (delete-region start end) (insert out))
              (progn (delete-region start end) (insert (upcase out))))) nil)))
  (if (use-region-p)
      (let ((regionp (buffer-substring start end)))
	(cond ((cmp-and-fixcase regionp "aa" "á"))
	      ((cmp-and-fixcase regionp "ga" "à"))
	      ((cmp-and-fixcase regionp "ta" "ã"))
	      ((cmp-and-fixcase regionp "ae" "é"))
	      ((cmp-and-fixcase regionp "ge" "è"))
	      ((cmp-and-fixcase regionp "te" "ẽ"))
	      ((cmp-and-fixcase regionp "ce" "ê"))
	      ((cmp-and-fixcase regionp "co" "ô"))
	      ((cmp-and-fixcase regionp "to" "õ"))
	      ((cmp-and-fixcase regionp "ai" "í"))))))
(global-set-key (kbd "C-: C-a") 'my-latin-accents-function)
#+END_SRC

